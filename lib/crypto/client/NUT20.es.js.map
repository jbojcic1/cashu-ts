{"version":3,"file":"NUT20.es.js","sources":["../../../src/crypto/client/NUT20.ts"],"sourcesContent":["import { schnorr } from '@noble/curves/secp256k1';\nimport { SerializedBlindedMessage } from '../../model/types';\nimport { bytesToHex, hexToBytes } from '@noble/hashes/utils';\nimport { sha256 } from '@noble/hashes/sha256';\n\nfunction constructMessage(\n\tquote: string,\n\tblindedMessages: Array<SerializedBlindedMessage>\n): Uint8Array {\n\tlet message = quote;\n\tfor (const blindedMessage of blindedMessages) {\n\t\tmessage += blindedMessage.B_;\n\t}\n\tconst msgbytes = new TextEncoder().encode(message);\n\treturn sha256(msgbytes);\n}\n\nexport function signMintQuote(\n\tprivkey: string,\n\tquote: string,\n\tblindedMessages: Array<SerializedBlindedMessage>\n): string {\n\tconst message = constructMessage(quote, blindedMessages);\n\tconst privkeyBytes = hexToBytes(privkey);\n\tconst signature = schnorr.sign(message, privkeyBytes);\n\treturn bytesToHex(signature);\n}\n\nexport function verifyMintQuoteSignature(\n\tpubkey: string,\n\tquote: string,\n\tblindedMessages: Array<SerializedBlindedMessage>,\n\tsignature: string\n): boolean {\n\tconst sigbytes = hexToBytes(signature);\n\tlet pubkeyBytes = hexToBytes(pubkey);\n\tif (pubkeyBytes.length !== 33) return false;\n\tpubkeyBytes = pubkeyBytes.slice(1);\n\tconst message = constructMessage(quote, blindedMessages);\n\treturn schnorr.verify(sigbytes, message, pubkeyBytes);\n}\n"],"names":["constructMessage","quote","blindedMessages","message","blindedMessage","msgbytes","sha256","signMintQuote","privkey","privkeyBytes","hexToBytes","signature","schnorr","bytesToHex","verifyMintQuoteSignature","pubkey","sigbytes","pubkeyBytes"],"mappings":";;;AAKA,SAASA,EACRC,GACAC,GACa;AACb,MAAIC,IAAUF;AACd,aAAWG,KAAkBF;AAC5B,IAAAC,KAAWC,EAAe;AAE3B,QAAMC,IAAW,IAAI,cAAc,OAAOF,CAAO;AACjD,SAAOG,EAAOD,CAAQ;AACvB;AAEgB,SAAAE,EACfC,GACAP,GACAC,GACS;AACH,QAAAC,IAAUH,EAAiBC,GAAOC,CAAe,GACjDO,IAAeC,EAAWF,CAAO,GACjCG,IAAYC,EAAQ,KAAKT,GAASM,CAAY;AACpD,SAAOI,EAAWF,CAAS;AAC5B;AAEO,SAASG,EACfC,GACAd,GACAC,GACAS,GACU;AACJ,QAAAK,IAAWN,EAAWC,CAAS;AACjC,MAAAM,IAAcP,EAAWK,CAAM;AAC/B,MAAAE,EAAY,WAAW,GAAW,QAAA;AACxB,EAAAA,IAAAA,EAAY,MAAM,CAAC;AAC3B,QAAAd,IAAUH,EAAiBC,GAAOC,CAAe;AACvD,SAAOU,EAAQ,OAAOI,GAAUb,GAASc,CAAW;AACrD;"}